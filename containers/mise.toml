# tools
# env
#
[env]
TARGET_TICKET_ID = { required = true }
GITHUB_TOKEN = { required = true }
GIT_AUTHOR_NAME = "SWE Agent"
GIT_AUTHOR_EMAIL = "dev@l1x.be"
GIT_COMMITTER_NAME = "SWE Agent"
GIT_COMMITTER_EMAIL = "dev@l1x.be"
GIT_ASKPASS = ""  # Prevent interactive prompts
GIT_TERMINAL_PROMPT = "0"

# tasks
[tasks.repo]
description = "Clone the repository"
# Clean command, no auth scripts needed thanks to the credential helper
run = "git clone --no-hardlinks /host-repo workspace"

[tasks.git]
description = "Configuring git"
# This connects standard 'git clone' to the 'gh' CLI's auth
dir = "workspace"
depends = ["repo"]
run = """
git config --global credential.helper '!gh auth git-credential'
git remote set-url origin https://github.com/l1x/agent-prompts.git
git fetch origin main
git checkout -b "agent/${TARGET_TICKET_ID}" origin/main
"""

[tasks.agent]
description = "Run the agent"
depends = ["branch"]
dir = "workspace"
run = """
echo 'agent-run'
"""
