# tools
# env
#
[env]
TARGET_TICKET_ID = { required = true }
GITHUB_TOKEN = { required = true }
GIT_AUTHOR_NAME = "SWE Agent"
GIT_AUTHOR_EMAIL = "dev@l1x.be"
GIT_COMMITTER_NAME = "SWE Agent"
GIT_COMMITTER_EMAIL = "dev@l1x.be"
GIT_ASKPASS = ""  # Prevent interactive prompts
GIT_TERMINAL_PROMPT = "0"

# tasks
[tasks.git]
description = "One-time config to tell git to use gh for auth"
# This connects standard 'git clone' to the 'gh' CLI's auth
run = "git config --global credential.helper '!gh auth git-credential'"

[tasks.repo]
description = "Clone the repository"
depends = ["configure-git"]
# Clean command, no auth scripts needed thanks to the credential helper
run = "git clone --local /host-repo /workspace"

[tasks.branch]
description = "Create and checkout the feature branch"
depends = ["repo"]
dir = "/workspace"
# Uses the TARGET_TICKET_ID verified in [env]
run = """
git fetch origin main
git checkout -b "agent/${TARGET_TICKET_ID}" origin/main
"""

[tasks.agent]
description = "Run the agent"
depends = ["branch"]
dir = "/workspace"
run = """
mise run agent
"""
